<launch>
    <group ns="mobile_base">
        <node pkg="nodelet" type="nodelet" name="mobile_base_nodelet_manager" args="manager"/>

        <node pkg="nodelet" type="nodelet" name="kobuki_node"
              args="load kobuki_node/KobukiNodelet mobile_base_nodelet_manager">
            <rosparam file="$(find kobuki_node)/param/base.yaml"/>
            <remap from="~enable"       to="enable"/>
            <remap from="~disable"      to="disable"/>
            <remap from="~odom"         to="/odom"/>
            <remap from="~joint_states" to="/joint_states"/>
        </node>

        <node pkg="diagnostic_aggregator" type="aggregator_node" name="diagnostic_aggregator">
            <rosparam file="$(find kobuki_node)/param/diagnostics.yaml"/>
        </node>

        <node pkg="nodelet" type="nodelet" name="cmd_vel_mux"
              args="load yocs_cmd_vel_mux/CmdVelMuxNodelet mobile_base_nodelet_manager">
            <param name="yaml_cfg_file" value="$(find locobot_bringup)/param/cmd_vel_mux.yaml"/>
            <remap from="~output" to="kobuki_node/commands/velocity"/>
        </node>

        <node pkg="nodelet" type="nodelet" name="safety_controller"
              args="load kobuki_safety_controller/SafetyControllerNodelet mobile_base_nodelet_manager">
            <remap from="~events/bumper"     to="kobuki_node/events/bumper"/>
            <remap from="~events/cliff"      to="kobuki_node/events/cliff"/>
            <remap from="~events/wheel_drop" to="kobuki_node/events/wheel_drop"/>
            <remap from="~cmd_vel"           to="cmd_vel_mux/input/safety_controller"/>
        </node>

        <node pkg="nodelet" type="nodelet" name="velocity_smoother"
              args="load yocs_velocity_smoother/VelocitySmootherNodelet mobile_base_nodelet_manager">
            <rosparam file="$(find yocs_velocity_smoother)/param/standalone.yaml"/>
            <remap from="~odometry"       to="odom"/>
            <remap from="~robot_cmd_vel"  to="kobuki_node/commands/velocity"/>
            <remap from="~smooth_cmd_vel" to="cmd_vel_mux/input/navi"/>
        </node>
        <!-- Also add a smoother for teleop? -->
    </group>
</launch>
